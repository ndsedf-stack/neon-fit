<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>HYBRID 63 // OPS CENTER</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800&family=Inter:wght@400;500;600;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <style>
    :root {
      --cyan: #22d3ee;
      --cyan-glow: rgba(34, 211, 238, 0.6);
      --violet: #8b5cf6;
      --violet-glow: rgba(139, 92, 246, 0.6);
      --dark-bg: #020617;
      --card-bg: rgba(15, 23, 42, 0.65);
    }

    body {
      background-color: var(--dark-bg);
      font-family: 'Inter', sans-serif;
      color: #e2e8f0;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
      /* Padding safe area for iPhone */
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* --- CANVAS BACKGROUND --- */
    #neuro-net {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        z-index: -2;
        background: radial-gradient(circle at 50% 30%, #1e1b4b 0%, #020617 80%);
    }

    /* --- TYPOGRAPHY --- */
    .font-hud { font-family: 'Rajdhani', sans-serif; }
    .font-mono-tech { font-family: 'Share Tech Mono', monospace; }
    
    .text-glow-cyan { text-shadow: 0 0 15px var(--cyan-glow); }
    .text-glow-violet { text-shadow: 0 0 15px var(--violet-glow); }

    /* --- TIMELINE (3D SCROLL) --- */
    .timeline-wrapper {
        perspective: 1000px;
        overflow-x: auto;
        padding: 20px 0;
        scroll-snap-type: x mandatory;
        scrollbar-width: none;
    }
    .timeline-wrapper::-webkit-scrollbar { display: none; }

    .week-chip {
        scroll-snap-align: center;
        transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        transform-style: preserve-3d;
        background: rgba(30, 41, 59, 0.4);
        border: 1px solid rgba(255,255,255,0.1);
        backdrop-filter: blur(10px);
    }

    .week-chip.active {
        background: rgba(34, 211, 238, 0.15);
        border-color: var(--cyan);
        transform: scale(1.15) translateZ(20px);
        box-shadow: 0 0 30px rgba(34, 211, 238, 0.3);
        z-index: 10;
    }
    
    .week-chip.deload.active {
        background: rgba(245, 158, 11, 0.15);
        border-color: #f59e0b;
        box-shadow: 0 0 30px rgba(245, 158, 11, 0.3);
    }

    /* --- HOLO CARDS --- */
    .holo-card {
        background: var(--card-bg);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
    }
    
    /* Neon Line Top */
    .holo-card::before {
        content: '';
        position: absolute;
        top: 0; left: 0; width: 100%; height: 1px;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
    }

    .holo-card.expanded {
        background: rgba(15, 23, 42, 0.9);
        border-color: rgba(34, 211, 238, 0.3);
        box-shadow: 0 10px 40px -10px rgba(0,0,0,0.8);
    }

    /* Grid Texture */
    .grid-texture {
        background-image: 
            linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
        background-size: 20px 20px;
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: -1;
    }

    /* --- DETAILS ACCORDION --- */
    .details-wrapper {
        display: grid;
        grid-template-rows: 0fr;
        transition: grid-template-rows 0.4s ease-out;
    }
    .holo-card.expanded .details-wrapper {
        grid-template-rows: 1fr;
    }
    .details-inner { overflow: hidden; }

    /* --- EXERCISE ROW --- */
    .ex-row {
        position: relative;
        padding-left: 16px;
    }
    .ex-row::before {
        content: '';
        position: absolute;
        left: 0; top: 8px; bottom: 8px;
        width: 2px;
        background: rgba(255,255,255,0.1);
    }
    .ex-row.superset::before {
        background: var(--violet);
        box-shadow: 0 0 8px var(--violet);
        width: 3px;
    }

    /* --- BOTTOM NAV --- */
    .nav-dock {
        background: rgba(2, 6, 23, 0.9);
        backdrop-filter: blur(30px) saturate(180%);
        border-top: 1px solid rgba(255,255,255,0.1);
        padding-bottom: calc(env(safe-area-inset-bottom) + 10px);
    }
    .nav-btn.active { color: #22d3ee; }
    .nav-btn.active .icon-glow { filter: drop-shadow(0 0 8px var(--cyan)); }

  </style>
</head>
<body class="selection:bg-cyan-500/30">

  <!-- DYNAMIC BACKGROUND -->
  <canvas id="neuro-net"></canvas>

  <!-- STICKY HEADER -->
  <header class="fixed top-0 w-full z-50 bg-[#020617]/90 backdrop-blur-xl border-b border-white/5 pt-[env(safe-area-inset-top)]">
      <div class="flex justify-between items-center px-5 py-4">
          <div>
              <div class="flex items-center gap-2 mb-0.5">
                  <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse shadow-[0_0_8px_#22c55e]"></span>
                  <span class="text-[10px] font-bold tracking-[0.2em] text-slate-400 uppercase font-mono-tech">COMMAND CENTER</span>
              </div>
              <h1 class="text-2xl font-hud font-black text-white italic tracking-wide">
                  TRAINING<span class="text-cyan-500">_OPS</span>
              </h1>
          </div>
          <button onclick="window.location.href='index.html'" class="w-10 h-10 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white hover:border-cyan-500 transition-all active:scale-95">
              <i data-lucide="x" class="w-5 h-5"></i>
          </button>
      </div>

      <!-- 3D TIMELINE -->
      <div class="border-t border-white/5 bg-black/20">
          <div class="timeline-wrapper flex px-5 gap-3" id="timeline">
              <!-- JS Injected -->
          </div>
      </div>
  </header>

  <!-- SCROLLABLE CONTENT -->
  <main class="relative z-10 pt-[200px] px-4 pb-40 space-y-6">

      <!-- PHASE INTEL (Dynamic Banner) -->
      <section id="intel-panel" class="relative overflow-hidden rounded-2xl border border-cyan-500/20 bg-gradient-to-r from-cyan-950/40 to-slate-900/40 p-5 shadow-[0_0_30px_rgba(0,0,0,0.5)]">
          <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10 mix-blend-overlay"></div>
          
          <div class="relative z-10 flex flex-col gap-3">
              <div class="flex justify-between items-start">
                  <div>
                      <div class="text-[9px] text-cyan-400 font-bold uppercase tracking-widest mb-1">Active Phase Protocol</div>
                      <h2 class="text-2xl font-hud font-black text-white uppercase text-glow-cyan leading-none" id="block-title">LOADING...</h2>
                  </div>
                  <div class="text-right">
                       <div class="text-[9px] text-slate-400 font-bold uppercase tracking-widest mb-1">Intensity</div>
                       <div class="text-3xl font-mono-tech font-bold text-yellow-400" id="rpe-display">--</div>
                  </div>
              </div>

              <div class="h-px w-full bg-gradient-to-r from-transparent via-cyan-500/30 to-transparent"></div>

              <div class="flex items-center justify-between">
                  <div class="flex items-center gap-2">
                      <i data-lucide="zap" class="w-4 h-4 text-cyan-400"></i>
                      <span class="text-xs font-bold text-white uppercase tracking-wide" id="technique-display">---</span>
                  </div>
                  <!-- Deload Indicator -->
                  <div id="deload-badge" class="hidden px-2 py-0.5 rounded bg-orange-500/20 border border-orange-500/50 text-[9px] font-bold text-orange-400 uppercase tracking-wider animate-pulse">
                      Recovery Mode
                  </div>
              </div>
          </div>
      </section>

      <!-- WORKOUTS STACK -->
      <div id="workouts-list" class="space-y-4">
          <!-- JS Injected Cards -->
      </div>

  </main>

  <!-- BOTTOM NAV -->
  <nav class="fixed bottom-0 w-full nav-dock z-50">
      <div class="flex justify-around items-center h-[80px] px-2">
          <a href="index.html" class="nav-btn flex flex-col items-center gap-1 p-2 w-16 group text-slate-500 transition-colors">
              <i data-lucide="layout-grid" class="w-6 h-6 icon-glow transition-transform group-active:scale-95"></i>
              <span class="text-[9px] font-bold uppercase tracking-wider">Base</span>
          </a>
          
          <button class="nav-btn flex flex-col items-center gap-1 p-2 w-16 group text-slate-500 transition-colors">
              <i data-lucide="bar-chart-2" class="w-6 h-6 icon-glow transition-transform group-active:scale-95"></i>
              <span class="text-[9px] font-bold uppercase tracking-wider">Stats</span>
          </button>
          
          <!-- FAB -->
          <div class="relative -top-6">
              <button class="w-16 h-16 rounded-full bg-gradient-to-b from-cyan-400 to-blue-600 flex items-center justify-center shadow-[0_0_25px_rgba(34,211,238,0.5)] border border-white/20 transform transition-all active:scale-90 group">
                   <div class="absolute inset-0 rounded-full border border-white/30 animate-[ping_3s_ease-out_infinite]"></div>
                   <i data-lucide="play" class="w-7 h-7 text-white fill-current ml-1 group-hover:scale-110 transition-transform"></i>
              </button>
          </div>

          <button class="nav-btn active flex flex-col items-center gap-1 p-2 w-16 group">
              <i data-lucide="calendar" class="w-6 h-6 icon-glow transition-transform group-active:scale-95"></i>
              <span class="text-[9px] font-bold uppercase tracking-wider">Plan</span>
          </button>
          
          <button class="nav-btn flex flex-col items-center gap-1 p-2 w-16 group text-slate-500 transition-colors">
              <i data-lucide="user" class="w-6 h-6 icon-glow transition-transform group-active:scale-95"></i>
              <span class="text-[9px] font-bold uppercase tracking-wider">ID</span>
          </button>
      </div>
  </nav>

  <script type="module">
    import programData from './program-data.js';

    // --- CANVAS BG ---
    const canvas = document.getElementById('neuro-net');
    const ctx = canvas.getContext('2d');
    let width, height, particles = [];

    function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize);
    resize();

    class Particle {
        constructor() {
            this.x = Math.random() * width; this.y = Math.random() * height;
            this.vx = (Math.random() - 0.5) * 0.2; this.vy = (Math.random() - 0.5) * 0.2;
            this.size = Math.random() * 2;
        }
        update() {
            this.x += this.vx; this.y += this.vy;
            if (this.x < 0 || this.x > width) this.vx *= -1;
            if (this.y < 0 || this.y > height) this.vy *= -1;
        }
        draw() {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.08)';
            ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
        }
    }
    for (let i = 0; i < 40; i++) particles.push(new Particle());
    function animate() {
        ctx.clearRect(0, 0, width, height);
        particles.forEach(p => { p.update(); p.draw(); });
        requestAnimationFrame(animate);
    }
    animate();

    // --- LOGIC ---
    let currentWeek = 1;

    function init() {
        renderTimeline();
        updateView(currentWeek);
        lucide.createIcons();
    }

    function renderTimeline() {
        const container = document.getElementById('timeline');
        container.innerHTML = '';
        
        for (let i = 1; i <= 26; i++) {
            const isDeload = programData.isDeloadWeek(i);
            const chip = document.createElement('div');
            chip.className = `week-chip flex-shrink-0 w-16 h-20 rounded-xl flex flex-col items-center justify-center cursor-pointer relative ${i === currentWeek ? 'active' : ''} ${isDeload ? 'deload' : ''}`;
            
            chip.onclick = () => {
                currentWeek = i;
                document.querySelectorAll('.week-chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
                chip.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
                updateView(i);
            };
            
            chip.innerHTML = `
                <span class="text-[9px] font-bold uppercase tracking-wider ${isDeload ? 'text-orange-400' : 'text-slate-400'} mb-1">WK</span>
                <span class="text-2xl font-hud font-bold text-white">${i}</span>
                ${isDeload ? '<div class="absolute top-1 right-1 w-1.5 h-1.5 bg-orange-500 rounded-full"></div>' : ''}
            `;
            container.appendChild(chip);
        }
    }

    function updateView(weekNum) {
        const weekData = programData.getWeek(weekNum);
        const blockName = programData.info.blockTechniques[`block${weekData.block}`]?.name || 'Unknown';
        
        // Update Intel
        document.getElementById('block-title').textContent = blockName;
        document.getElementById('technique-display').textContent = weekData.technique;
        document.getElementById('rpe-display').textContent = weekData.rpeTarget;
        
        const deloadBadge = document.getElementById('deload-badge');
        if (weekData.isDeload) deloadBadge.classList.remove('hidden');
        else deloadBadge.classList.add('hidden');

        // Render Cards
        const list = document.getElementById('workouts-list');
        list.innerHTML = '';
        
        const days = ['dimanche', 'mardi', 'vendredi', 'maison'];
        const meta = {
            'dimanche': { color: 'cyan', label: 'FULL BODY' },
            'mardi': { color: 'violet', label: 'UPPER BODY' },
            'vendredi': { color: 'emerald', label: 'HYBRID' },
            'maison': { color: 'amber', label: 'HOME' }
        };

        days.forEach(day => {
            const workout = weekData[day];
            if (!workout) return;
            const theme = meta[day];

            const card = document.createElement('div');
            card.className = "holo-card group";
            
            // Calculate Total Load
            let totalLoad = 0;
            workout.exercises.forEach(ex => {
                const reps = typeof ex.reps === 'string' ? parseInt(ex.reps.split('-')[0]) : ex.reps;
                totalLoad += ex.sets * reps * ex.weight;
            });

            card.innerHTML = `
                <div class="grid-texture"></div>
                
                <!-- HEADER (Clickable) -->
                <div class="p-5 cursor-pointer" onclick="toggleCard(this)">
                    <div class="flex justify-between items-start">
                         <div class="flex gap-4 items-center">
                             <div class="w-14 h-14 rounded-2xl bg-${theme.color}-500/10 border border-${theme.color}-500/30 flex flex-col items-center justify-center shadow-[0_0_15px_rgba(0,0,0,0.2)]">
                                 <span class="text-[10px] font-bold text-${theme.color}-400 uppercase">${day.substring(0,3)}</span>
                                 <i data-lucide="dumbbell" class="w-5 h-5 text-white mt-0.5"></i>
                             </div>
                             
                             <div>
                                 <div class="flex items-center gap-2 mb-1">
                                     <span class="px-1.5 py-0.5 rounded-[4px] bg-white/5 border border-white/10 text-[9px] font-bold text-slate-400 uppercase">${theme.label}</span>
                                     <span class="text-[9px] font-mono-tech text-slate-500">${workout.duration} MIN</span>
                                 </div>
                                 <h3 class="text-lg font-hud font-bold text-white uppercase leading-tight max-w-[200px]">${workout.name.split('+')[0]}</h3>
                             </div>
                         </div>
                         
                         <div class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center transition-transform group-[.expanded]:rotate-180">
                             <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400"></i>
                         </div>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="flex gap-4 mt-4 pl-[72px]">
                         <div class="text-xs font-mono-tech text-slate-400"><span class="text-white font-bold">${workout.totalSets}</span> SETS</div>
                         <div class="text-xs font-mono-tech text-slate-400"><span class="text-${theme.color}-400 font-bold">${(totalLoad/1000).toFixed(1)}T</span> VOL</div>
                    </div>
                </div>

                <!-- DETAILS (Accordion) -->
                <div class="details-wrapper bg-black/20 border-t border-white/5">
                    <div class="details-inner">
                        <div class="p-5 space-y-3">
                            ${workout.exercises.map((ex) => `
                            <div class="ex-row ${ex.isSuperset ? 'superset' : ''}">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <div class="text-xs font-bold text-white uppercase mb-0.5 line-clamp-1">${ex.name}</div>
                                        <div class="text-[10px] text-slate-500 font-mono-tech flex items-center gap-2">
                                            <span>${ex.sets} x ${ex.reps}</span>
                                            ${ex.isSuperset ? '<span class="text-violet-400 font-bold px-1 bg-violet-500/10 rounded">SUPERSET</span>' : ''}
                                        </div>
                                    </div>
                                    <div class="text-right bg-white/5 px-2 py-1 rounded border border-white/5 min-w-[50px]">
                                        <div class="text-xs font-mono-tech font-bold text-white">${ex.weight}<span class="text-[8px] text-slate-500 ml-0.5">KG</span></div>
                                    </div>
                                </div>
                            </div>
                            `).join('')}
                        </div>
                        
                        <div class="p-4 bg-gradient-to-t from-${theme.color}-500/20 to-transparent flex justify-center">
                            <button onclick="startSession(${weekNum}, '${day}')" class="w-full py-3 bg-${theme.color}-500 hover:bg-${theme.color}-400 text-white font-bold uppercase font-hud tracking-widest rounded-xl shadow-[0_0_20px_rgba(0,0,0,0.3)] active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                                Initiate Mission <i data-lucide="arrow-right" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            list.appendChild(card);
        });
        
        lucide.createIcons();
    }

    window.toggleCard = (el) => {
        const card = el.parentElement;
        const wasExpanded = card.classList.contains('expanded');
        
        // Collapse all
        document.querySelectorAll('.holo-card').forEach(c => c.classList.remove('expanded'));
        
        if (!wasExpanded) {
            card.classList.add('expanded');
            // Scroll to card a bit
            setTimeout(() => card.scrollIntoView({behavior: 'smooth', block: 'center'}), 300);
        }
    };

    window.startSession = (week, day) => {
        window.location.href = `session.html?week=${week}&day=${day}`;
    };

    // Init
    init();

  </script>
</body>
</html>
